# ğŸ“ React Hook ç¬”è®°ï¼šuseRef

## 1. æ ¸å¿ƒæ¦‚å¿µ (The Mental Model)

`useRef` æ˜¯ React å‡½æ•°ç»„ä»¶ä¸­çš„**â€œé€ƒç”Ÿèˆ±â€**ã€‚å®ƒå…è®¸ä½ åœ¨ç»„ä»¶çš„å¤šæ¬¡æ¸²æŸ“ä¹‹é—´â€œçªƒè¿â€æ•°æ®ï¼Œè€Œä¸ä¼šè§¦å‘ React çš„æ›´æ–°æœºåˆ¶ã€‚

### ğŸ“Œ å®šä¹‰

```JavaScript
const ref = useRef(initialValue);
```

å®ƒè¿”å›ä¸€ä¸ª**å¯å˜çš„ï¼ˆMutableï¼‰** å¯¹è±¡ï¼Œç»“æ„æ°¸è¿œæ˜¯ `{ current: ... }`ã€‚

### ğŸ§  å¿ƒæ™ºæ¨¡å‹ï¼šç›’å­ (The Box)

- **`useState`**ï¼šåƒæ˜¯**ä¸€å¼ ç…§ç‰‡**ã€‚æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸€å¼ æ–°çš„ç…§ç‰‡ï¼Œé‡Œé¢çš„æ•°æ®æ˜¯å®šæ ¼çš„ï¼ˆImmutableï¼‰ã€‚
    
- **`useRef`**ï¼šåƒæ˜¯æ”¾åœ¨æ¡Œå­ä¸Šçš„**ä¸€ä¸ªç›’å­**ã€‚
    
    - ä½ å¯ä»¥éšæ—¶å¾€é‡Œé¢æ”¾ä¸œè¥¿ï¼Œæˆ–è€…æŠŠä¸œè¥¿æ‹¿å‡ºæ¥ã€‚
        
    - ä¸ç®¡ä½ æ‹å¤šå°‘å¼ ç…§ç‰‡ï¼ˆç»„ä»¶æ¸²æŸ“å¤šå°‘æ¬¡ï¼‰ï¼Œç›’å­å§‹ç»ˆæ˜¯**åŒä¸€ä¸ª**ç›’å­ï¼ˆå¼•ç”¨åœ°å€ä¸å˜ï¼‰ã€‚
        
    - æœ€é‡è¦çš„æ˜¯ï¼š**å¾€ç›’å­é‡Œæ”¾ä¸œè¥¿ï¼Œä¸ä¼šè§¦å‘ç…§ç›¸æœºæ‹ç…§**ï¼ˆä¿®æ”¹ `current` ä¸ä¼šè§¦å‘ Re-renderï¼‰ã€‚
        

---

## 2. ä¸¤å¤§ä¸»è¦ç”¨é€”

### A. è®¿é—® DOM èŠ‚ç‚¹ (ä¼ ç»Ÿçš„ Ref)

è¿™æ˜¯æœ€å¸¸è§çš„ç”¨æ³•ã€‚React æ˜¯å£°æ˜å¼çš„ï¼Œä½†åœ¨æŸäº›åœºæ™¯ï¼ˆå¦‚èšç„¦ã€åª’ä½“æ’­æ”¾ã€é›†æˆç¬¬ä¸‰æ–¹ DOM åº“ï¼‰éœ€è¦å‘½ä»¤å¼æ“ä½œ DOMã€‚

```JavaScript
function TextInput() {
  const inputRef = useRef(null); // 1. åˆ›å»º Ref

  const handleFocus = () => {
    // 3. é€šè¿‡ .current è®¿é—®çœŸå® DOM
    inputRef.current.focus(); 
  };

  return (
    <>
      {/* 2. ç»‘å®šåˆ° JSX å…ƒç´  */}
      <input ref={inputRef} />
      <button onClick={handleFocus}>Focus Input</button>
    </>
  );
}
```

### B. å­˜å‚¨â€œç±»å®ä¾‹â€å˜é‡ (Instance Variables)

åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æŠŠ `timerID`ã€`subscription` ç­‰ä¸å‚ä¸ UI æ¸²æŸ“çš„æ•°æ®å­˜æ”¾åœ¨ `this` ä¸Šã€‚åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œ`useRef` å°±æ˜¯é‚£ä¸ª `this`ã€‚

**å…¸å‹åœºæ™¯**ï¼šæ¸…é™¤å®šæ—¶å™¨ã€è§£å†³é—­åŒ…é™·é˜±ï¼ˆStale Closureï¼‰ã€è®°å½•ä¸Šä¸€æ¬¡çš„ Propsã€‚

```JavaScript
function Timer() {
  const intervalRef = useRef(); // å­˜å‚¨å®šæ—¶å™¨ ID

  useEffect(() => {
    intervalRef.current = setInterval(() => {
      // ... logic
    }, 1000);

    return () => {
      // å¯ä»¥åœ¨ cleanup ä¸­è¯»å–åˆ°åŒä¸€ä¸ª ID è¿›è¡Œæ¸…é™¤
      clearInterval(intervalRef.current);
    };
  }, []);
}
```

---

## 3. useRef vs. useState (çµé­‚æ‹·é—®)

|**ç‰¹æ€§**|**useState**|**useRef**|
|---|---|---|
|**è¿”å›å€¼**|`[value, setValue]`|`{ current: value }`|
|**è§¦å‘æ¸²æŸ“**|**ä¼šè§¦å‘** Re-render|**ä¸ä¼šè§¦å‘** Re-render|
|**æ›´æ–°æ—¶æœº**|å¼‚æ­¥ï¼ˆå¯èƒ½è¢«æ‰¹å¤„ç†ï¼‰|åŒæ­¥ï¼ˆç«‹å³å˜æ›´ï¼‰|
|**æ•°æ®æ€§è´¨**|Immutable (å¿«ç…§)|Mutable (å¼•ç”¨å®¹å™¨)|
|**ä¸»è¦ç”¨é€”**|å­˜å‚¨å½±å“ UI æ˜¾ç¤ºçš„æ•°æ®|å­˜å‚¨**ä¸å½±å“ UI** çš„æ•°æ® / DOM|

**å†³ç­–å£è¯€**ï¼š

> "å¦‚æœè¿™ä¸ªæ•°æ®çš„å˜åŒ–**ä¸éœ€è¦**è®©å±å¹•å‘ç”Ÿé—ªåŠ¨æˆ–å˜åŒ–ï¼Œé‚£å°±ç”¨ `useRef`ã€‚"

---

## 4. å¸¸è§è¯¯åŒºä¸ç¦å¿Œ (The Gotchas)

### ğŸš« ç¦å¿Œï¼šä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å†™ Ref

React çš„æ¸²æŸ“è¿‡ç¨‹ï¼ˆRender Phaseï¼‰åº”è¯¥æ˜¯çº¯å‡€çš„ï¼ˆPureï¼‰ã€‚

- **é”™è¯¯ç¤ºèŒƒ**ï¼š
    
    JavaScript
    
    ```
    function BadComponent() {
      const count = useRef(0);
    
      // âŒ ä¸¥ç¦ï¼è¿™æ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¿®æ”¹ Ref
      // è¿™ä¼šå¯¼è‡´è¡Œä¸ºä¸å¯é¢„æµ‹ï¼Œä¸”ç ´å React çš„å¹¶å‘æ¨¡å¼
      count.current = count.current + 1; 
    
      // âŒ ä¸¥ç¦ï¼æ¸²æŸ“ç»“æœä¾èµ– Refï¼Œä½† Ref å˜äº†ä¸ä¼šæ›´æ–°è§†å›¾
      return <div>{count.current}</div>;
    }
    ```
    
- **æ­£ç¡®åšæ³•**ï¼šåªåœ¨ **Event Handlers** æˆ– **Effects** ä¸­ä¿®æ”¹å’Œè¯»å– Refã€‚
    

### âš ï¸ åŒºåˆ«ï¼šuseRef vs. createRef

- `useRef(null)`ï¼šåœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…**åªåˆ›å»ºä¸€æ¬¡**å¯¹è±¡ã€‚
    
- `createRef()`ï¼š**æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»º**ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚
    
    - å¦‚æœä½ åœ¨å‡½æ•°ç»„ä»¶é‡Œç”¨ `createRef`ï¼Œå®ƒå­˜ä¸ä½æ•°æ®ï¼Œå› ä¸ºä¸‹æ¬¡æ¸²æŸ“å®ƒå°±è¢«é‡ç½®äº†ã€‚
        

---

## 5. é«˜çº§æŠ€å·§ï¼šè‡ªå®šä¹‰ Hook `usePrevious`

è¿™æ˜¯ä¸€ä¸ªåˆ©ç”¨ `useRef` è®°å½•â€œä¸Šä¸€æ¬¡çŠ¶æ€â€çš„ç»å…¸æ¡ˆä¾‹ï¼Œå®Œç¾ä½“ç°äº†å…¶â€œæ»åæ€§â€å’Œâ€œå­˜å‚¨â€èƒ½åŠ›ã€‚

```JavaScript
function usePrevious(value) {
  const ref = useRef();
  
  useEffect(() => {
    ref.current = value; // åœ¨æ¸²æŸ“â€œä¹‹åâ€æ‰æ›´æ–° Ref
  }, [value]); 
  
  return ref.current; // è¿”å›çš„æ˜¯æ›´æ–°â€œä¹‹å‰â€çš„å€¼
}

// ä½¿ç”¨
function App() {
  const [count, setCount] = useState(0);
  const prevCount = usePrevious(count);
  
  // æ¸²æŸ“æ—¶ï¼š
  // count = 1
  // prevCount = 0 (å› ä¸º useEffect è¿˜æ²¡è·‘ï¼Œref è¿˜æ²¡æ›´æ–°)
  // æ¸²æŸ“åï¼šuseEffect æ‰§è¡Œï¼Œref.current å˜ä¸º 1
}
```

---

## 6. æ€»ç»“

1. **Ref æ˜¯é€ƒç”Ÿèˆ±**ï¼šç”¨äºå¤„ç† React æ•°æ®æµä¹‹å¤–çš„å‰¯ä½œç”¨ã€‚
    
2. **Ref æ˜¯å®¹å™¨**ï¼šå®ƒä¸»è¦ç”¨äºæ‰“ç ´â€œé—­åŒ…â€çš„é™åˆ¶ï¼Œè·å–æœ€æ–°çš„å€¼ã€‚
    
3. **Ref ä¸å¼•å‘æ¸²æŸ“**ï¼šå®ƒæ˜¯é™é»˜çš„ã€‚
    

å¸Œæœ›è¿™ä»½ç¬”è®°èƒ½å¸®æ‚¨æ¢³ç†æ¸…æ¥š `useRef` çš„çŸ¥è¯†ä½“ç³»ï¼å¦‚æœæ‚¨æƒ³æ·±å…¥äº†è§£ **Ref æ˜¯å¦‚ä½•é…åˆ `forwardRef` ç©¿é€ç»„ä»¶ä¼ é€’çš„**ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚